<apex:page id="thpage"  standardController="BMCServiceDesk__Task__c" extensions="BMCServiceDesk.ConsoleTaskDetailController,BMCServiceDesk.ConsoleRemoteActions"  standardStylesheets="true" showHeader="false" sidebar="false" >
<head>
	<link rel="stylesheet" href="{!$Resource.SDEFStyles}/ConsoleDetail.css" type="text/css" />
</head>
<body onload="doOnLoadActivity()">
    <apex:form id="theForm"  onclick="parent.hideMenu();">
    <apex:actionFunction name="calculateDueDate" action="{!calculateDueDate}" rerender="picklistPanel,tableOutputpanel" >
    	<apex:param assignTo="{!selectOption}" name="option" value=""/>
    </apex:actionFunction>
    <apex:actionFunction name="calculateDueDateRTF" action="{!calculateDueDateRTF}" rerender="messagePanel,picklistPanel, dueDatePanel" >
        <apex:param assignTo="{!selectOption}" name="option" value=""/>
    </apex:actionFunction>
     <apex:actionFunction action="{!saveRecord}" name="save" rerender="messagePanel,picklistPanel, dueDatePanel" oncomplete="stopWaitMsgBar();">
    	 <apex:param assignTo="{!queueName}" name="strQueueName" value=""/>
    </apex:actionFunction>
     <apex:actionFunction action="{!saveRecordWR}" name="saveWithRerender" rerender="messagePanel, picklistPanel,dueDatePanel,errorPanel,renderPanel,tableOutputpanel" oncomplete="stopWaitMsgBar();displayMessage();">
     <apex:param assignTo="{!queueName}" name="strQueueName" value=""/>
     </apex:actionFunction>
     <apex:actionFunction action="{!applyTemplate}" name="applyTemplate" rerender="messagePanel, tableOutputpanel, picklistPanel" oncomplete="stopWaitMsgBar();">
     	<apex:param assignTo="{!templateId}" name="templateId" value=""/> 
     </apex:actionFunction>        
     <script>
      var categoryName = '';
      var templateFieldName = '';
      var urgencyLookupId = '';
	  var impactLookupId = '';
	  var statusLookupId = '';
      var userIDHiddenFieldID = '';
      var contactFieldId ='';
	  var userName = '';
	  var userId = '';
     </script>    
               <apex:outputPanel id="tableOutputpanel" layout="block" style="overflow:none;height:100%;width:100%">  
                  <apex:outputPanel id="messagePanel" styleClass="messageContainer">            
                    <apex:pageMessages id="pageMessage" />            
                    <script> 
                    	window.scroll(0,0);
                    </script>            
                </apex:outputPanel> 
                <div id='autocompleteDiv' class="clsAutocompleteDiv">
                     <select id="selectAutoOptions" class="clsAutocompleteSelectOption" onmousedown="isAutocomplete = true;"  onclick="SelectAutoValue(this,'autocompleteDiv');" multiple="multiple"  >
                     </select>
                 </div> 
                  <apex:pageBlock id="thePAgeBlock" title="" >
                          <table style="overflow:none;height:100%;width:100%">
                               <tr>
                                    <td style="overflow:none;height:15px;width:100%">
                                     <apex:facet name="header">   
                                        <table >  
                                            <tr>   
                                                 <td align="center">
													<span><a id="taskLink" href="#thpage:theForm:thePAgeBlock:sec1" class="toplink" >{!$Label.bmcservicedesk__Console_ClientDetails}</a></span><span class="separator"> | </span>
													<span><a id="taskLink" href="#thpage:theForm:thePAgeBlock:sec2" class="toplink" >{!$Label.bmcservicedesk__Console_TaskDetails}</a></span><span class="separator"> | </span>
													<span><a id="stPrLink" href="#thpage:theForm:thePAgeBlock:sec3" class="toplink" >{!$Label.bmcservicedesk__Console_StatusAndPriority}</a></span><span class="separator"> | </span>
													<span><a id="stPrLink" href="#thpage:theForm:thePAgeBlock:sec4" class="toplink" >{!$Label.bmcservicedesk__Console_DateAndTime}</a></span><span class="separator"> | </span>
                                                    <span><a id="stPrLink" href="#thpage:theForm:thePAgeBlock:sec6" class="toplink" >{!$Label.bmcservicedesk__Console_Assignment}</a></span>
                                                </td>
                                            </tr>
                                        </table>
                                        </apex:facet>   
                                    </td>
                                </tr>
                                 <tr>
                                    <td >
                                        <div   style="width:100%; overflow: auto;">
                                        <apex:pageBlockSection id="sec1" title="{!$Label.bmcservicedesk__Console_ClientDetails}" columns="{!columnSize}" > 
                                          <apex:repeat value="{!lstClientDetailFS}" var="f">
                                              <apex:pageblockSectionItem rendered="{!$ObjectType.BMCServiceDesk__Task__c.fields[f.fieldPath].Accessible}">  
                                                    <apex:outputlabel value="{!f.label}"/>   
                                                    <apex:outputPanel > 
                                                        <table>
                                               	        	<tr>
                                                            	<td>
																	<apex:outputPanel rendered="{!CONTAINS(f.fieldPath,'FKClient__c')}">
																		<table>
		                                                                    <tr>
		                                                                        <td><div class="requiredInput"><div style="display:{!if(isLeadOrContactFound, 'none', 'block')}" class="requiredBlock"></div>
		                                                                            <apex:inputText id="User__username" value="{!clientName}" styleClass="clsInputTextBox" title="{!$ObjectType.BMCServiceDesk__Task__c.fields.BMCServiceDesk__FKClient__c.inlineHelpText}"
		                                                                            				onKeyUp="findClients('sel3','autocompleteUserNameDiv',this,event)"  onblur="disableDiv('autocompleteUserNameDiv');"/><br />
		                                                                            		<script>
																								userName = '{!$Component.User__username}';
																							 </script>
		                                                                            		<div id='autocompleteUserNameDiv' class="clsAutocompleteDiv">
											                                                    <select id="sel3" class="clsAutocompleteSelectOption" onmousedown="isAutocomplete = true;"  onclick="SelectValue(this,'autocompleteUserNameDiv');" multiple="multiple"  >
											                                                    </select>
											                                                </div>
		                                                                            <apex:inputHidden value="{!task.BMCServiceDesk__FKClient__c}" id="User__id"/>
		                                                                            <script>  
																						userId = '{!$Component.User__id}';
                                                                                        userIDHiddenFieldID = '{!$Component.User__id}';
																					 </script>
		                                                                            </div>
		                                                                        </td>
		                                                                        <td >
		                                                                            <a id="clientLookup" title="{!$ObjectType.Task__c.fields.FKClient__c.label} {!JSENCODE($Label.tooltipForLookup)}" onclick="setLastMousePosition(event);openLookupPopUP();" href="javascript:void(0)">
		                                                                            <img class="lookupIcon" title="{!$ObjectType.Task__c.fields.FKClient__c.label} {!JSENCODE($Label.tooltipForLookup)}" 
		                                                                                    onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
		                                                                                    onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" 
		                                                                                    onfocus="this.className = 'lookupIconOn';" onblur="this.className = 'lookupIcon';" alt="{!$ObjectType.Task__c.fields.FKClient__c.label} {!JSENCODE($Label.tooltipForLookup)}" src="/s.gif" />
		                                                                            </a>
		                                                                        </td>
                                                                                <td>
                                                                                    <div class="tooltip">
                                                                                        <input  type = "button" id="infoBtn" class="bmcUserInfoPopup" onmouseover="callClientTooltip(event);"/>
                                                                                        <span class="custom critical" id="spanTTClientInfo" style="display:none; left:1em;" >
                                                                                            <div id="clientInfoTooltipContent">
                                                                                            </div>
                                                                                            <div id="clientInfoTooltipInit" style="display:none"><div style="width:150px"><img src = "{!$Resource.SDEFStyles}/SDEFimages/loading.gif" /> {!JSENCODE($Label.SSLoading)}...</div></div>                                                                                       
                                                                                        </span>
                                                                                    </div>
                                                                                </td>                                                                                  
		                                                                    </tr>
		                                                                </table> 
																	</apex:outputPanel>
																</td>
																<td>	
			                                                        <apex:outputPanel rendered="{!NOT(CONTAINS(f.fieldPath,'FKClient__c'))}">
				                                                        <apex:inputField id="inputField" value="{!task[f.fieldPath]}" required="{!OR(f.required, f.DBRequired)}" onclick="resetCalPosition();" />  
				                                                       	<script>
                                                                            var val = '{!f.fieldPath}';
                                                                            
                                                                            if(val.indexOf('FKContact__c') !=-1){
                                                                                contactFieldId = '{!$Component.inputField}';
                                                                                contactFieldId = contactFieldId +'_lkid';
                                                                            }  
				                                                            var titleval = '{!$Component.inputField}';
				                                                            document.getElementById(titleval).title = '{!JSENCODE($ObjectType.Task__c.fields[f.fieldPath].inlineHelpText)}';
				                                                        </script>
				                                                    </apex:outputPanel>    
			                                                    </td>
                                                                <td>
                                                                    <apex:outputPanel rendered="{!CONTAINS(f.fieldPath,'FKContact__c')}"> 
                                                                    <div class="tooltip" >
                                                                        <input  type = "button" id="infoBtn1" class="bmcUserInfoPopup"  onmouseover="callContactTooltip(event);"/>
                                                                        <span class="custom critical" id="spanTTContactInfo" style="display:none; left:1em;" >
                                                                            <div id="contactInfoTooltipContent">
                                                                            </div>
                                                                            <div id="contactInfoTooltipInit" style="display:none"><div style="width:150px"><img src = "{!$Resource.SDEFStyles}/SDEFimages/loading.gif" /> {!JSENCODE($Label.SSLoading)}...</div></div>                                                                                      
                                                                        </span>
                                                                    </div>
                                                                    </apex:outputPanel>
                                                                </td>
		                                                    </tr>
	                                                   </table>     
                                                	</apex:outputPanel>
                                              	</apex:pageblockSectionItem>    
                                          </apex:repeat>
                                        </apex:pageBlockSection>
                                        <apex:pageBlockSection id="sec2" title="{!$Label.bmcservicedesk__Console_TaskDetails}" columns="{!columnSize}" > 
                                              <apex:repeat value="{!TaskDetails}" var="f">
                                                   <apex:pageBlockSectionItem rendered="{!$ObjectType.BMCServiceDesk__Task__c.fields[f.fieldPath].Accessible}">
                                                         <apex:outputLabel value="{!f.label}" />
                                                          <apex:outputPanel >
                                                                <table>
                                                                    <tr>
                                                                        <td>
                                                                        	<apex:outputPanel rendered="{!CONTAINS(f.fieldPath,'FKCategory__c')}">
																				<apex:outputPanel >
																					<table>
																						<tr>
																							<td>
																								<apex:inputText id="categroyLookUp" value="{!categoryName}" styleClass="clsInputTextBox" 
																									title="{!$ObjectType.BMCServiceDesk__Task__c.fields.BMCServiceDesk__FKCategory__c.inlineHelpText}"
																									onKeyUp="keyUpfun('selectAutoOptions','autocompleteDiv',this,event)"  onblur="disableDiv('autocompleteDiv');"/><br />
																								 <script>
									                                                           	     categoryName = '{!$Component.categroyLookUp}';
									                                                           	   </script>      
																								 <apex:inputHidden value="{!task.BMCServiceDesk__FKCategory__c}" id="category__id"/>
																							</td>
																							<td >
																								<a id="catLookup" title="{!$ObjectType.Task__c.fields.FKCategory__c.label} {!JSENCODE($Label.tooltipForLookup)}" onclick="setLastMousePosition(event);openCategoryPopUP();" href="javascript:void(0)">
																								<img class="lookupIcon" title="{!$ObjectType.Task__c.fields.FKCategory__c.label} {!JSENCODE($Label.tooltipForLookup)}" 
																										onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
																										onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" 
																										onfocus="this.className = 'lookupIconOn';" onblur="this.className = 'lookupIcon';" alt="{!$ObjectType.Task__c.fields.FKCategory__c.label} {!JSENCODE($Label.tooltipForLookup)}" src="/s.gif" />
																								</a>
																							</td>
																						</tr>
																					</table> 
																				</apex:outputPanel>
																			</apex:outputPanel>
																			 <apex:outputPanel rendered="{!NOT(CONTAINS(f.fieldPath,'FKCategory__c'))}" >
                                                                             <apex:inputField id="inputField" value="{!task[f.fieldPath]}" required="{!OR(f.required, f.DBRequired)}"
                                                                                    rendered="{!NOT(CONTAINS(f.fieldPath,'FKCategory__c'))}" />
                                                                                <script>
                                                                                    var val = '{!f.fieldPath}';
						                                                           	if(val.indexOf('FKTemplate__c') !=-1){
                                                                                        templateFieldName = '{!$Component.inputField}';
                                                                                    } 
                                                                                    
                                                                                    var titleval = '{!$Component.inputField}';
						                                                            document.getElementById(titleval).title = '{!JSENCODE($ObjectType.Task__c.fields[f.fieldPath].inlineHelpText)}'; 
						                                                             
                                                                                </script>   
                                                                             </apex:outputPanel> 
                                                                        </td>
                                                                    </tr>
                                                                </table> 
                                                            </apex:outputPanel>
                                                    </apex:pageBlockSectionItem>    
                                                </apex:repeat>
                                         </apex:pageBlockSection>
                                         
                                         <apex:pageBlockSection id="sec3" title="{!$Label.bmcservicedesk__Console_StatusAndPriority}" columns="{!columnSize}" > 
                                              <apex:repeat value="{!StatusAndProirity}" var="f">
                                              	   <apex:pageBlockSectionItem rendered="{!$ObjectType.BMCServiceDesk__Task__c.fields[f.fieldPath].Accessible}">
                                              	   		<apex:outputLabel value="{!f.label}" />
                                              	   			<apex:outputPanel >
                                                                <table>
                                                                    <tr>
                                                                   		<td>
                                                                        	<apex:outputPanel rendered="{!CONTAINS(f.fieldPath,'FKUrgency__c')}">
                                                                        		<apex:outputPanel >
                                                                        			<table>
																						<tr>
																							<td>
				                                                                        		<select id="urgencySelectId" onchange="setUrgencyValue(this.id);" title="{!$ObjectType.Task__c.fields.FKUrgency__c.inlineHelpText}">
				                                                                        		</select>
				                                                                        		<apex:inputHidden value="{!task.BMCServiceDesk__FKUrgency__c}" id="urgency__id"/>
				                                                                        		<script>
													                                                 urgencyLookupId = '{!$Component.urgency__id}';
													                                            </script>
													                                        </td>
																						</tr>
																					</table> 
																				</apex:outputPanel>
                                                                        	</apex:outputPanel>
                                                                        	<apex:outputPanel rendered="{!CONTAINS(f.fieldPath,'FKImpact__c')}">
                                                                        		<apex:outputPanel >
                                                                        			<table>
																						<tr>
																							<td>
				                                                                        		<select id="impactSelectId" onchange="setImpactValue(this.id);" title="{!$ObjectType.Task__c.fields.FKImpact__c.inlineHelpText}">
				                                                                        		</select>
				                                                                        		<apex:inputHidden value="{!task.BMCServiceDesk__FKImpact__c}" id="impact__id"/>
				                                                                        		<script>
													                                                 impactLookupId = '{!$Component.impact__id}';
													                                            </script>
													                                        </td>
																						</tr>
																					</table> 
																				</apex:outputPanel>
                                                                        	</apex:outputPanel>
                                                                        	<apex:outputPanel rendered="{!CONTAINS(f.fieldPath,'FKStatus__c')}" title="{!$ObjectType.BMCServiceDesk__Task__c.fields.BMCServiceDesk__FKStatus__c.inlineHelpText}">
                                                                        		<apex:outputPanel >
                                                                        			<table>
																						<tr>
																							<td>
				                                                                        		<select id="statusSelectId" onchange="setStatusValue(this.id);">
				                                                                        		</select>
				                                                                        		<apex:inputHidden value="{!task.BMCServiceDesk__FKStatus__c}" id="status__id"/>
				                                                                        		<script>
													                                                 statusLookupId = '{!$Component.status__id}';
													                                            </script>
													                                        </td>
																						</tr>
																					</table> 
											                                    </apex:outputPanel>
                                                                        	</apex:outputPanel>
			                                                                 <apex:outputPanel rendered="{!AND(NOT(CONTAINS(f.fieldPath,'FKUrgency__c')),NOT(CONTAINS(f.fieldPath,'FKImpact__c')),NOT(CONTAINS(f.fieldPath,'FKStatus__c')))}">        
	                                                  							<apex:inputField id="inputField" value="{!task[f.fieldPath]}" required="{!OR(f.required, f.DBRequired)}" 
                                                  										rendered="{!AND(NOT(CONTAINS(f.fieldPath,'FKUrgency__c')),NOT(CONTAINS(f.fieldPath,'FKImpact__c')),NOT(CONTAINS(f.fieldPath,'FKStatus__c')))}"/>
                                                  								<script>
						                                                            var titleval = '{!$Component.inputField}';
						                                                            document.getElementById(titleval).title = '{!JSENCODE($ObjectType.Task__c.fields[f.fieldPath].inlineHelpText)}';
						                                                        </script>
                                                  							</apex:outputPanel>				       
                                                  						</td>
                                                  					</tr> 
                                                  				</table> 
                                                  			</apex:outputPanel>
                                                  </apex:pageBlockSectionItem>  
                                              </apex:repeat>
                                         </apex:pageBlockSection>
                                         <apex:pageBlockSection id="sec4" title="{!$Label.bmcservicedesk__Console_DateAndTime}" columns="{!columnSize}" > 
                                              <apex:repeat value="{!DateAndTime}" var="f">
                                                  <apex:pageblockSectionItem rendered="{!$ObjectType.BMCServiceDesk__Task__c.fields[f.fieldPath].Accessible}">  
                                                    <apex:outputlabel value="{!f.label}"/>   
                                                    <apex:outputPanel > 
                                                        <apex:inputField id="inputField" value="{!task[f.fieldPath]}" required="{!OR(f.required, f.DBRequired)}" />
                                                        <script>
                                                            var titleval = '{!$Component.inputField}';
                                                            document.getElementById(titleval).title = '{!JSENCODE($ObjectType.Task__c.fields[f.fieldPath].inlineHelpText)}';
                                                        </script>
                                                    </apex:outputPanel>
                                                  </apex:pageblockSectionItem>   
                                              </apex:repeat>
                                         </apex:pageBlockSection>
                                         
                                         <apex:pageBlockSection id="sec6" title="{!$Label.bmcservicedesk__Console_Assignment}" columns="{!columnSize}" > 
                                              <apex:pageBlockSectionItem id="pageblock6Item1">
                                                      <apex:outputLabel value="{!if((enableQueueAndUserAssignment),$Label.bmcservicedesk__Queue,$Label.bmcservicedesk__ConsoleOwner)}" />
                                                          <apex:outputPanel >
                                                                <table>
                                                                    <tr>
                                                                        <td>
                                                                            <input type="text" value="{!if((enableQueueAndUserAssignment),queueName,ownerName)}"   
                                                                            	tiltle = "{!$ObjectType.Task__c.fields.ownerid.inlineHelpText}" Class="readonlyTextBox" id="owner_Name"  readonly="readonly"   />
	                                                                            <apex:inputHidden value="{!task.BMCServiceDesk__FKOpenBy__c}" id="ownerOpenby_Id"/>
	                                                                            <apex:inputHidden value="{!task.ownerid}" id="owner_Id"/>
	                                                                            <apex:inputHidden value="{!queueId}" id="queueId"/>
                                                                        </td>
                                                                        <td >
                                                                             <img class="closeIconDis" src="/s.gif" title="{!$Label.Clear}" alt="Clear" onclick="resetQueueText();return false;" 
                                                                        		onmouseout="this.className='closeIconDis'"  onmouseover="this.className='closeIconEnable'; " style="cursor: pointer;"/>
                                                                             <img class="lookupIcon" title="{!if((enableQueueAndUserAssignment),$Label.Queue,$ObjectType.Incident__c.fields.ownerid.label)} {!JSENCODE($Label.tooltipForLookup)}" 
                                                                                onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
                                                                                onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" onclick="openOwnerLookupPopUP(enableQueueAndUserAssignment?'QUEUE':'OWNER','');return false;"
                                                                                onfocus="this.className = 'lookupIconOn';" onblur="this.className = 'lookupIcon';" alt="{!if((enableQueueAndUserAssignment),$Label.Queue,$ObjectType.Task__c.fields.FKOpenBy__c.label)} {!JSENCODE($Label.tooltipForLookup)}" src="/s.gif" style="cursor: pointer;" />
                                                                          </td>
                                                                    </tr>
                                                                </table> 
                                                            </apex:outputPanel>
                                                    </apex:pageBlockSectionItem>    
                                                    <apex:pageBlockSectionItem id="pageblock6Item2" rendered="{!enableQueueAndUserAssignment}">
                                                         <apex:outputLabel value="{!JSENCODE($Label.bmcservicedesk__StaffWindowHeaderSearchPage)}" />
                                                          <apex:outputPanel >
                                                                <table>
                                                                    <tr>
                                                                        <td>
                                                                            <apex:inputText id="staffId" value="{!staffName}"   title="{!$ObjectType.BMCServiceDesk__Task__c.fields.BMCServiceDesk__FKOpenBy__c.inlineHelpText}"  styleClass="readonlyTextBox" />
                                                                        </td>
                                                                        <td >
                                                                             <img class="closeIconDis" src="/s.gif" title="{!$Label.Clear}" alt="Clear" onclick="resetStaffText();return false;" 
                                                                                onmouseout="this.className='closeIconDis'"  onmouseover="this.className='{!IF(enableQueueAndUserAssignment == true,'closeIconEnable','closeIconDis')}'" style="cursor: pointer;"/>
                                                                              <img class="lookupIcon" title="{!$ObjectType.Task__c.fields.FKOpenBy__c.label} {!JSENCODE($Label.tooltipForLookup)}" 
                                                                                onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
                                                                                onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" onclick="openOwnerLookupPopUP('STAFF',queueId);return false;"
                                                                                onfocus="this.className = 'lookupIconOn';" onblur="this.className = 'lookupIcon';" alt="{!$ObjectType.Task__c.fields.FKOpenBy__c.label} {!JSENCODE($Label.tooltipForLookup)}" src="/s.gif" style="cursor: pointer;" />
                                                                          </td>
                                                                    </tr>
                                                                </table> 
                                                            </apex:outputPanel>
                                                    </apex:pageBlockSectionItem>                                
                                         </apex:pageBlockSection>
                                         </div>
                                    </td>
                                </tr>
                          </table> 
                    </apex:pageBlock> 
                </apex:outputPanel>
    </apex:form> 
    <script> 
        var keyMap = new Array(); 
        var orgNamespace = '{!orgNamespace}';
        var selectClientId=0; 
        var isAutocomplete = false;
        var saveSuccess = '{!JSENCODE($Label.SavedSuccessfully)}';
        var searchErrorMsg = '{!JSENCODE($Label.GsErrorMsg)}';
        var categoryId = '';
        var categoryLookupId = '';
        var isRTFEnabled = true;
        
       	var OverwriteWarning = '{!JSENCODE($Label.OverwriteWarning)}';
        var TemplateValidationError = '{!JSENCODE($Label.TemplateValidationError)}';
        var applytemplateToExistingRecord = '{!JSENCODE(applytemplateToExistingRecord)}';
		var overrideRecWithTemplateVal = '{!JSENCODE(overrideRecWithTemplateVal)}';
		var TaskIsClosed = '{!JSENCODE($Label.Task_is_Closed)}';
		
		
		
        var enableQueueAndUserAssignment = {!enableQueueAndUserAssignment};
        var ownerType ='';
        if(userName != null && userName !=''){
	        document.getElementById(userName).focus();
	        document.getElementById(userName).autocomplete= "off";
        }
        var ownerOpenById = '{!$Component.theForm.thePAgeBlock.sec6.pageblock6Item1.ownerOpenby_Id}';
		var staffId = '{!$Component.thpage:theForm:thePAgeBlock:sec6.pageblock6Item2.staffId}';
		var ownerId = '{!$Component.thpage.theForm.thePAgeBlock.sec6.pageblock6Item1.owner_Id}';
		var strQueueId = '{!$Component.thpage.theForm.thePAgeBlock.sec6.pageblock6Item1.queueId}';
        var columnSize = {!columnSize};
        var requestDetail = null;
        var taskId = '{!JSENCODE(task.Id)}';
        var clientId = '{!JSENCODE(task.FKClient__c)}';
        var selectedCatId = '{!JSENCODE(task.FKCategory__c)}';
        var status = '{!task.state__c}';
        _RemotingActions={}
        _RemotingActions.clientAutoData = '{!$RemoteAction.ConsoleRemoteActions.clientAutoData}';
         _RemotingActions.fetchAutoSelectData= '{!$RemoteAction.ConsoleRemoteActions.fetchAutoSelectData}';
        var setTaskData;
        var saveTask = function doSave(){ 
        	if (!{!isLeadOrContactFound}) { 
				if (userId !='' && document.getElementById(userId).value == '') {
					alert('{!JSENCODE($Label.errorMsgForMandatoryClient)}');
					return false;
				}
			}
        	var strQueueName = document.getElementById('owner_Name').value;
        	startWaitMsgBar();
         	if(window.parent.RTFEnabledPage())
         	save(strQueueName);
        	else
        		saveWithRerender(strQueueName);	
        }
        
      if(window.parent.saveTask!=undefined){
            window.parent.saveTask(saveTask);
        }
    </script> 
    <apex:outputPanel id="renderPanel">             
        <script>
        	var queueId = '{!queueId}';         
            taskId = '{!JSENCODE(task.Id)}';
        	clientId = '{!JSENCODE(task.FKClient__c)}';
        	status = '{!task.state__c}';
            setTaskData = function setTaskData(){            
            var arr = new Array();
			arr['Id'] = '{!JSENCODE(task.Id)}';
            arr['Name'] = '{!JSENCODE(task.Name)}';
            arr[ 'FKCategory__c' ] = '{!JSENCODE(task.FKCategory__c)}';
            arr[ 'Stage__c' ] = getTranslatedStage();
            arr[ 'FKClient__c' ] = '{!JSENCODE(task.FKClient__c)}'; 
            arr[ 'state__c' ] =  '{!task.state__c}';
            arr[ 'id' ] =  '{!task.id}';
            arr[ 'taskDescription__c' ]='{!JSENCODE(task.taskDescription__c)}';
            return arr;
            
        };
        
         function getTranslatedStage(){
         	
         	 if('{!JSENCODE(task.FKStatus__r.Stage__c)}' =='Opened'){
	           return '{!JSENCODE($Label.StageProgression_Opened)}';
            }else if('{!JSENCODE(task.FKStatus__r.Stage__c)}' =='Acknowledged'){
            	return '{!JSENCODE($Label.StageProgression_Acknowledged)}';
            }else if('{!JSENCODE(task.FKStatus__r.Stage__c)}' =='In Process'){
            	return '{!JSENCODE($Label.StageProgression_InProcess)}';
            }else if('{!JSENCODE(task.FKStatus__r.Stage__c)}' =='Closed'){
            	return '{!JSENCODE($Label.StageProgression_Closed)}';
            }else{
            	return '{!JSENCODE(task.FKStatus__r.Stage__c)}';
            }
         }
      
        if(window.parent.setTaskData!=undefined){
            window.parent.setTaskData(setTaskData);
        }
        </script>   
        </apex:outputPanel>    
    <apex:outputPanel id="errorPanel">             
        <script>         
		  var messageStr  = '{!JSENCODE(messageString)}';
          
           function displayMessage(){
            	if(!isRTFEnabled && messageStr!=null && messageStr !=''){
            		if(messageStr == saveSuccess){
            			window.parent.afterSaveSucceed();
            			alert(saveSuccess);
            			showDueDatePopup();
            		}else{
            			alert(messageStr);
            		}
            	}
            }
            
            if(document.getElementById(templateFieldName)!=null 
				&& document.getElementById(templateFieldName)!='undefined' && document.getElementById(templateFieldName)!=''){
					
					if(applytemplateToExistingRecord == 'false' && taskId!=''){
						document.getElementById(templateFieldName).readOnly = 'true';
					}else if(taskId!='' && status=='false'){
						document.getElementById(templateFieldName).readOnly = 'true';
					}
			}
             
        </script>   
        </apex:outputPanel>          
    <apex:outputPanel id="oncePanel">        
        <script>         
           
            var i = 0;
            <apex:repeat value="{!keyPrefixMap}" var="lst">
                keyMap[i] = new Array(2);
                var objectWithKey = '{!lst}';
                var splitKey = objectWithKey.split(':');
                keyMap[i][0] = splitKey[0];
                keyMap[i][1] = splitKey[1];
                i++;
            </apex:repeat>
             
        </script>   
        </apex:outputPanel>
    <apex:outputPanel id="dueDatePanel">
		<script>
			var showPopUp = '{!showDueDatePopUp}';
			window.parent.isDeleted = false;
			if ({!isDeleted}) {
				window.parent.isDeleted = true;
			}	
		</script>
	</apex:outputPanel>
<apex:outputPanel id="picklistPanel">
	<script>
			var urgencySelect  = document.getElementById('urgencySelectId');
			
			if(urgencySelect!=null && urgencySelect!='undefined' && urgencySelect!=''){
				urgencySelect.options[urgencySelect.options.length] = new Option(window.parent._ServerLabels.None1, window.parent._ServerLabels.None1);
				var urgencySelectedIndex='';
				var urgencyObj =  window.parent.Ext.JSON.decode(window.parent._ServerVariables.urgencyMap,true);
				var urgencyFieldVal = document.getElementById(urgencyLookupId).value;
				
				// iterate urgency map and populate urgency piclist field select options
				for(var i=0; i<urgencyObj.Response.length;i++) {
				
					if(urgencyFieldVal!=null && urgencyFieldVal!='undefined'&& urgencyFieldVal!='' 
										&& urgencyFieldVal==urgencyObj.Response[i].id){
						
						urgencySelectedIndex = urgencySelect.options.length;
						
					  }
					 urgencySelect.options[urgencySelect.options.length] = new Option(decodeURIComponent(urgencyObj.Response[i].name.replace(/\+/g,  " ")), urgencyObj.Response[i].id);
				}
				
				if(urgencySelectedIndex!=''){
					urgencySelect.selectedIndex = urgencySelectedIndex;
				}
			}
			
			var impactSelect  = document.getElementById('impactSelectId');
			
			if(impactSelect!=null && impactSelect!='undefined' && impactSelect!=''){
				impactSelect.options[impactSelect.options.length] = new Option(window.parent._ServerLabels.None1, window.parent._ServerLabels.None1);
				var impactSelectedIndex='';
				var impactObj =  window.parent.Ext.JSON.decode(window.parent._ServerVariables.impactMap,true);
				var impactFieldVal = document.getElementById(impactLookupId).value;
				
				// iterate impact map and populate impact piclist field select options
				for(var i=0; i<impactObj.Response.length;i++) {
					
					if(impactFieldVal!=null && impactFieldVal!='undefined' && impactFieldVal!='' 
									&& impactFieldVal==impactObj.Response[i].id){
						
						impactSelectedIndex = impactSelect.options.length;
						
					}
					  
					 impactSelect.options[impactSelect.options.length] = new Option(decodeURIComponent(impactObj.Response[i].name.replace(/\+/g,  " ")), impactObj.Response[i].id);
				}
				
				if(impactSelectedIndex!=''){
					impactSelect.selectedIndex = impactSelectedIndex;
				}
			}
			
			var statusSelect  = document.getElementById('statusSelectId');
			
			if(statusSelect!=null && statusSelect!='undefined' && statusSelect!=''){
				
				var statusObj =  window.parent.Ext.JSON.decode(window.parent._ServerVariables.statusMap,true);
				var statusSelectedIndex='';
				var statusFieldVal = document.getElementById(statusLookupId).value;
				
				//iterate status map and populate status piclist field select options
				for(var i=0; i<statusObj.Response.length;i++) {
				
					if(statusFieldVal!=null && statusFieldVal!='undefined' && statusFieldVal!='' 
										&& statusFieldVal==statusObj.Response[i].id){
						
						statusSelectedIndex = statusSelect.options.length;
						
					}
					
					 var stOption = new Option(decodeURIComponent(statusObj.Response[i].name.replace(/\+/g,  " ")), statusObj.Response[i].id);
					 
					 if(stOption.text=='-'){
						stOption.disabled = true;
						stOption.text='--------------------';
					 }
					
					 statusSelect.options[statusSelect.options.length] = stOption;
				}
				
				if(statusSelectedIndex!=''){
					statusSelect.selectedIndex = statusSelectedIndex;
				}
			}

		</script>
	</apex:outputPanel>
    <script src="{!$Resource.SDEFCommonJS}/ConsoleTaskDetail.js"  type="text/javascript" />
	<script>
		handleElemEvent();
		if (document.getElementById('thpage:theForm:thePAgeBlock:sec6:pageblock6Item2:staffId') != null)
			document.getElementById('thpage:theForm:thePAgeBlock:sec6:pageblock6Item2:staffId').readOnly = true;
    </script>
	</body>
</apex:page>